local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Workspace = game:GetService("Workspace")
local Players = game:GetService("Players")
local Lighting = game:GetService("Lighting")

local lp = Players.LocalPlayer

-- [[ AUTO TAP Sƒ∞STEMƒ∞ ]] --
local NetworkModule = nil
local function initializeNetwork()
    local ok, res = pcall(function()
        local modulesFolder = ReplicatedStorage:WaitForChild("Modules", 5)
        if not modulesFolder then return nil end
        local network = modulesFolder:FindFirstChild("Network")
        if not network then return nil end
        return require(network)
    end)
    
    if ok and res and type(res) == "table" then
        NetworkModule = res
    end
end

local function fireClickV2()
    if not NetworkModule or type(NetworkModule.FireServer) ~= "function" then return end
    pcall(function()
        NetworkModule:FireServer("Tap", true)
    end)
end

local function startAutoClicker()
    task.spawn(function()
        while true do
            if _G.AutoTap then
                fireClickV2()
            end
            task.wait() -- Maksimum hƒ±zda √ßalƒ±≈üƒ±r
        end
    end)
end

-- [[ 1. Dƒ∞NAMƒ∞K NETWORK VE REMOTE BULUCU ]] --
local function GetNetwork()
    -- Favori y√∂ntem: Events ve Functions klas√∂rlerini barƒ±ndƒ±ran √ºst klas√∂r
    for _, v in pairs(ReplicatedStorage:GetChildren()) do
        if v:IsA("Folder") and v:FindFirstChild("Events") and v:FindFirstChild("Functions") then
            return v
        end
    end
    -- UUID formatƒ± taramasƒ± (32+ karakter ve tire i√ßerir)
    for _, v in pairs(ReplicatedStorage:GetChildren()) do
        if v:IsA("Folder") and #v.Name > 30 and v.Name:find("-") then
            return v
        end
    end
    return nil
end

local Network = GetNetwork()
if not Network then
    warn("‚ùå Network klas√∂r√º bulunamadƒ±! Remote'lar √ßalƒ±≈ümayabilir.")
end

local function getGameRemote(remoteName)
    if not Network then Network = GetNetwork() end
    if Network then
        local f = Network:FindFirstChild("Functions")
        local e = Network:FindFirstChild("Events")
        local target = (f and f:FindFirstChild(remoteName)) or (e and e:FindFirstChild(remoteName))
        if target then return target end
    end
    
    -- Yedek: T√ºm ReplicatedStorage'ƒ± tara
    for _, obj in ipairs(ReplicatedStorage:GetChildren()) do
        if obj:IsA("Folder") or obj:IsA("Configuration") then
            local f = obj:FindFirstChild("Functions")
            local e = obj:FindFirstChild("Events")
            local target = (f and f:FindFirstChild(remoteName)) or (e and e:FindFirstChild(remoteName))
            if target then return target end
            
            -- Direkt altƒ±nda olabilir mi?
            local direct = obj:FindFirstChild(remoteName)
            if direct then return direct end
        end
    end
    
    -- ReplicatedStorage k√∂k√ºnde olabilir (Nadir)
    return ReplicatedStorage:FindFirstChild(remoteName)
end

-- [[ 2. AGRESƒ∞F FPS BOOST (D√úNYAYI TEMƒ∞ZLE) ]] --
local function nukeWorld()
    for _, obj in pairs(Workspace:GetChildren()) do
        -- 1. Island Klas√∂r√ºn√ºn ƒ∞√ßini Cerrahi Temizle
        if obj.Name == "Island" then
            for _, child in pairs(obj:GetChildren()) do
                pcall(function() child:Destroy() end)
            end
        -- 2. Workspace'teki Diƒüer Gereksiz ≈ûeyleri Sil (Karakter, Kamera, Yumurtalar ve Base hari√ß)
        elseif obj.Name ~= lp.Name and 
        obj.Name ~= "Camera" and 
        obj.Name ~= "Eggs" and 
        not obj.Name:find("SafetyFloor") and 
        not obj:IsA("Terrain") then
            pcall(function() obj:Destroy() end)
        end
    end

    local eggsFolder = Workspace:FindFirstChild("Eggs")
    if eggsFolder then
        for _, egg in pairs(eggsFolder:GetChildren()) do
            -- Sadece hedef yumurtayƒ± bƒ±rak, gerisini sil
            if not egg.Name:find(_G.OPEN_EGG_NAME) then
                pcall(function() egg:Destroy() end)
            end
        end
    end
    Workspace.Terrain:Clear()
end

-- [[ 3. HAVA DURUMUNU VE EFEKTLERƒ∞ SIFIRLA ]] --
local function cleanLighting()
    Lighting.GlobalShadows = false
    Lighting.FogEnd = 9e9
    Lighting.Brightness = 1
    Lighting.ClockTime = 12
    Lighting.OutdoorAmbient = Color3.fromRGB(128, 128, 128)
    
    for _, effect in pairs(Lighting:GetChildren()) do
        if effect:IsA("PostEffect") or effect:IsA("Sky") or effect:IsA("Clouds") or effect:IsA("Atmosphere") then
            pcall(function() effect:Destroy() end)
        end
    end
    
    local sky = Instance.new("Sky", Lighting)
    sky.SunTextureId = ""
    sky.MoonTextureId = ""
end

-- [[ 4. SHOOTING STAR & EVENT ENGELLEYƒ∞Cƒ∞ ]] --
local function blockEvents()
    -- 1. ShootingStar mod√ºllerini ve mevcut efektleri sil
    local ssModule = ReplicatedStorage:FindFirstChild("ShootingStars", true)
    if ssModule then pcall(function() ssModule:Destroy() end) end

    for _, v in pairs(Workspace:GetDescendants()) do
        local name = v.Name:lower()
        if name:find("star") or name:find("shooting") then
            pcall(function() v:Destroy() end)
        end
    end

    -- 2. Yeni gelen event nesnelerini (Electric, Void, Star, Crab vb.) anƒ±nda engelle
    Workspace.DescendantAdded:Connect(function(v)
        local name = v.Name:lower()
        if name:find("star") or name:find("shooting") or name:find("electric") or name:find("void") or name:find("crab") or name:find("taco") or name:find("event") or name == "model" then
            task.wait()
            pcall(function() v:Destroy() end)
        end
    end)
    print("üö´ Event engelleyici ve ShootingStar temizleyici aktif!")
end

-- [[ 5. PAR√áACIK VE G√ñRSEL OPTƒ∞Mƒ∞ZASYON ]] --
local function optimizeVisuals()
    for _, v in pairs(Workspace:GetDescendants()) do
        if v:IsA("ParticleEmitter") or v:IsA("Trail") or v:IsA("Smoke") or v:IsA("Sparkles") then
            v.Enabled = false
        end
    end
    print("‚ú® G√∂rsel efektler optimize edildi.")
end

-- [[ 4. YUMURTAYI Gƒ∞ZLE ]] --
local function hideEgg(eggModel)
    if eggModel then
        for _, part in pairs(eggModel:GetDescendants()) do
            if part:IsA("BasePart") or part:IsA("MeshPart") then
                part.Transparency = 1 
                part.CastShadow = false
            elseif part:IsA("Decal") or part:IsA("Texture") then
                part:Destroy()
            elseif part:IsA("ParticleEmitter") or part:IsA("Trail") then
                part.Enabled = false
            end
        end
    end
end

-- [[ 5. G√úVENLƒ∞ ZEMƒ∞N ]] --
local function createFloorAtEgg(target)
    local floor = Instance.new("Part")
    floor.Name = "SafetyFloor"
    floor.Size = Vector3.new(50, 2, 50)
    floor.CFrame = target:GetPivot() * CFrame.new(0, -5, 0)
    floor.Anchored = true
    floor.Transparency = 0.5 
    floor.BrickColor = BrickColor.new("Bright blue")
    floor.Parent = Workspace
    return floor
end

-- Gold Machine i√ßin 100x100 Emniyet Zemini
local function createFloorAtMachine()
    local pos = Vector3.new(1415.5, 658.18, -13447.73)
    local floor = Instance.new("Part")
    floor.Name = "SafetyFloor"
    floor.Size = Vector3.new(50, 2, 50)
    floor.Position = pos + Vector3.new(0, -6, 0)
    floor.Anchored = true
    floor.Transparency = 0.5
    floor.BrickColor = BrickColor.new("Bright yellow")
    floor.Material = Enum.Material.Neon
    floor.Parent = Workspace
    print("üèóÔ∏è Gold Machine i√ßin 100x100 zemin olu≈üturuldu.")
    return floor
end

-- Rainbow Machine i√ßin 50x50 Emniyet Zemini
local function createFloorAtRainbowMachine()
    local pos = Vector3.new(1220.16, 664.95, -13373.58)
    local floor = Instance.new("Part")
    floor.Name = "SafetyFloor"
    floor.Size = Vector3.new(50, 2, 50)
    floor.Position = pos + Vector3.new(0, -6, 0)
    floor.Anchored = true
    floor.Transparency = 0.5
    floor.BrickColor = BrickColor.new("Carnation pink")
    floor.Material = Enum.Material.Neon
    floor.Parent = Workspace
    print("üèóÔ∏è Rainbow Machine i√ßin 50x50 zemin olu≈üturuldu.")
    return floor
end

-- [[ ANA √áALI≈ûTIRICI ]] --

-- ADIM 0: Oyunun ve Network'√ºn y√ºklenmesini bekle
if not game:IsLoaded() then game.Loaded:Wait() end
initializeNetwork()
startAutoClicker()
task.wait(6) -- Ba≈ülangƒ±√ß i√ßin ekstra g√ºvenlik beklemesi

-- ADIM 1: Adaya I≈üƒ±nlan
local tpRemote = getGameRemote("TeleportZone")
if tpRemote then
    print("üåê " .. _G.TELEPORT_ZONE .. " adasƒ±na ƒ±≈üƒ±nlanƒ±lƒ±yor...")
    tpRemote:InvokeServer(_G.TELEPORT_ZONE)
    task.wait(6) 
else
    warn("‚ö†Ô∏è Teleport Remote bulunamadƒ±!")
end

-- ADIM 2: Yumurtayƒ± Bul ve D√ºnyayƒ± Hazƒ±rla
local eggsFolder = Workspace:FindFirstChild("Eggs")
local eggModel = eggsFolder and (eggsFolder:FindFirstChild(_G.OPEN_EGG_NAME) or eggsFolder:FindFirstChild(_G.OPEN_EGG_NAME .. " Egg"))

if eggModel then
    print("üß± D√ºnya temizleniyor ve FPS boost uygulanƒ±yor...")
    nukeWorld()
    cleanLighting()
    blockEvents()
    optimizeVisuals()
    createFloorAtEgg(eggModel)
    createFloorAtMachine() 
    createFloorAtRainbowMachine()
    hideEgg(eggModel)
    
    task.wait(0.5)
    if lp.Character then
        lp.Character:PivotTo(eggModel:GetPivot() * CFrame.new(0, 0, 2))
    end
    
    -- ADIM 3: Auto Hatch
    print("üöÄ Sistem Aktif: " .. _G.OPEN_EGG_NAME .. " a√ßƒ±lƒ±yor!")

    task.spawn(function()
        while _G.AUTO_HATCH do
            local openRemote = getGameRemote("OpenEgg")
            if openRemote then
                -- Snowman veya Snowman Egg ikisini de dener
                local success = openRemote:InvokeServer(_G.OPEN_EGG_NAME, _G.OPEN_EGG_AMOUNT)
                if not success then
                    openRemote:InvokeServer(_G.OPEN_EGG_NAME .. " Egg", _G.OPEN_EGG_AMOUNT)
                end
            end
            task.wait(_G.HATCH_SPEED)
        end
    end)
else 
    warn("‚ùå Hedef yumurta (" .. _G.OPEN_EGG_NAME .. ") ƒ±≈üƒ±nlanƒ±lan adada bulunamadƒ±!")
end
