local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Workspace = game:GetService("Workspace")
local Players = game:GetService("Players")
local Lighting = game:GetService("Lighting")

local lp = Players.LocalPlayer

-- [[ AUTO TAP SÄ°STEMÄ° ]] --
local NetworkModule = nil
local function initializeNetwork()
    local ok, res = pcall(function()
        local modulesFolder = ReplicatedStorage:WaitForChild("Modules", 5)
        if not modulesFolder then return nil end
        local network = modulesFolder:FindFirstChild("Network")
        if not network then return nil end
        return require(network)
    end)
    
    if ok and res and type(res) == "table" then
        NetworkModule = res
    end
end

local function fireClickV2()
    if not NetworkModule or type(NetworkModule.FireServer) ~= "function" then return end
    pcall(function()
        NetworkModule:FireServer("Tap", true)
    end)
end

local function startAutoClicker()
    task.spawn(function()
        while true do
            if _G.AutoTap then
                fireClickV2()
            end
            task.wait() -- Maksimum hÄ±zda Ã§alÄ±ÅŸÄ±r
        end
    end)
end

-- [[ 1. DÄ°NAMÄ°K REMOTE BULUCU ]] --
-- ReplicatedStorage iÃ§indeki rastgele isimli klasÃ¶rÃ¼ ve iÃ§indeki fonksiyonlarÄ± bulur
local function getGameRemote(remoteName)
    for _, obj in ipairs(ReplicatedStorage:GetChildren()) do
        local functions = obj:FindFirstChild("Functions")
        if functions then
            local target = functions:FindFirstChild(remoteName)
            if target then
                return target
            end
        end
    end
    return nil
end

-- [[ 2. AGRESÄ°F FPS BOOST (DÃœNYAYI TEMÄ°ZLE) ]] --
local function nukeWorld()
    for _, obj in pairs(Workspace:GetChildren()) do
        if obj.Name ~= lp.Name and 
        obj.Name ~= "Camera" and 
        obj.Name ~= "Eggs" and 
        not obj.Name:find("SafetyFloor") and 
        not obj:IsA("Terrain") then
            pcall(function() obj:Destroy() end)
        end
    end

    local eggsFolder = Workspace:FindFirstChild("Eggs")
    if eggsFolder then
        for _, egg in pairs(eggsFolder:GetChildren()) do
            -- Sadece hedef yumurtayÄ± bÄ±rak, gerisini sil
            if not egg.Name:find(_G.OPEN_EGG_NAME) then
                pcall(function() egg:Destroy() end)
            end
        end
    end
    Workspace.Terrain:Clear()
end

-- [[ 3. HAVA DURUMUNU VE EFEKTLERÄ° SIFIRLA ]] --
local function cleanLighting()
    Lighting.GlobalShadows = false
    Lighting.FogEnd = 9e9
    Lighting.Brightness = 1
    Lighting.ClockTime = 12
    Lighting.OutdoorAmbient = Color3.fromRGB(128, 128, 128)
    
    for _, effect in pairs(Lighting:GetChildren()) do
        if effect:IsA("PostEffect") or effect:IsA("Sky") or effect:IsA("Clouds") then
            effect:Destroy()
        end
    end
    
    local sky = Instance.new("Sky", Lighting)
    sky.SunTextureId = ""
    sky.MoonTextureId = ""
end

-- [[ 4. YUMURTAYI GÄ°ZLE ]] --
local function hideEgg(eggModel)
    if eggModel then
        for _, part in pairs(eggModel:GetDescendants()) do
            if part:IsA("BasePart") or part:IsA("MeshPart") then
                part.Transparency = 1 
                part.CastShadow = false
            elseif part:IsA("Decal") or part:IsA("Texture") then
                part:Destroy()
            elseif part:IsA("ParticleEmitter") or part:IsA("Trail") then
                part.Enabled = false
            end
        end
    end
end

-- [[ 5. GÃœVENLÄ° ZEMÄ°N ]] --
local function createFloorAtEgg(target)
    local floor = Instance.new("Part")
    floor.Name = "SafetyFloor"
    floor.Size = Vector3.new(50, 2, 50)
    floor.CFrame = target:GetPivot() * CFrame.new(0, -5, 0)
    floor.Anchored = true
    floor.Transparency = 0.5 
    floor.BrickColor = BrickColor.new("Bright blue")
    floor.Parent = Workspace
    return floor
end

-- Belirlenen Kordinatlara 100x100 Emniyet Zemini OluÅŸtur
local function createFloorAtCoords()
    local pos = Vector3.new(-176.55, 214.05, 233.41)
    local floor = Instance.new("Part")
    floor.Name = "SafetyFloor"
    floor.Size = Vector3.new(100, 2, 100)
    floor.Position = pos + Vector3.new(0, -6, 0)
    floor.Anchored = true
    floor.Transparency = 0.5
    floor.BrickColor = BrickColor.new("Bright yellow")
    floor.Material = Enum.Material.Neon
    floor.Parent = Workspace
    print("ğŸ—ï¸ Hedef kordinat iÃ§in 100x100 zemin oluÅŸturuldu.")
    return floor
end

-- [[ ANA Ã‡ALIÅTIRICI ]] --

-- ADIM 0: Oyunun ve Network'Ã¼n yÃ¼klenmesini bekle
if not game:IsLoaded() then game.Loaded:Wait() end
task.wait(10) -- BaÅŸlangÄ±Ã§ iÃ§in ekstra gÃ¼venlik beklemesi

-- ADIM 1: Adaya IÅŸÄ±nlan
local tpRemote = getGameRemote("TeleportZone")
if tpRemote then
    print("ğŸŒ " .. _G.TELEPORT_ZONE .. " adasÄ±na Ä±ÅŸÄ±nlanÄ±lÄ±yor...")
    tpRemote:InvokeServer(_G.TELEPORT_ZONE)
    task.wait(8) -- IÅŸÄ±nlanma sonrasÄ± yÃ¼kleme iÃ§in bekle
else
    warn("âš ï¸ Teleport Remote bulunamadÄ±!")
end

-- ADIM 2: DÃ¼nyayÄ± Temizle ve Hedef Kordinata IÅŸÄ±nlan
initializeNetwork()
startAutoClicker()
nukeWorld()
cleanLighting()
createFloorAtCoords() -- 100x100 zemin hedef kordinata kuruldu

task.wait(0.2)
if lp.Character then
    print("ğŸ“ Hedef kordinatlara Ä±ÅŸÄ±nlanÄ±lÄ±yor...")
    lp.Character:PivotTo(CFrame.new(-176.55, 214.05, 233.41))
end

-- ADIM 3: YumurtayÄ± Bul ve Auto Hatch BaÅŸlat
task.spawn(function()
    print("ğŸ” " .. _G.OPEN_EGG_NAME .. " yumurtasÄ± aranÄ±yor...")
    local eggModel = nil
    local attempts = 0
    while not eggModel and attempts < 7 do
        local eggsFolder = Workspace:FindFirstChild("Eggs")
        eggModel = eggsFolder and (eggsFolder:FindFirstChild(_G.OPEN_EGG_NAME) or eggsFolder:FindFirstChild(_G.OPEN_EGG_NAME .. " Egg"))
        if not eggModel then
            attempts = attempts + 1
            task.wait(1)
        end
    end

    if eggModel then
        hideEgg(eggModel)
        print("ğŸš€ Sistem Aktif: " .. _G.OPEN_EGG_NAME .. " aÃ§Ä±lÄ±yor!")

        while _G.AUTO_HATCH do
            local openRemote = getGameRemote("OpenEgg")
            if openRemote then
                local success = openRemote:InvokeServer(_G.OPEN_EGG_NAME, _G.OPEN_EGG_AMOUNT)
                if not success then
                    openRemote:InvokeServer(_G.OPEN_EGG_NAME .. " Egg", _G.OPEN_EGG_AMOUNT)
                end
            end
            task.wait(_G.HATCH_SPEED)
        end
    else
        warn("âŒ " .. _G.OPEN_EGG_NAME .. " yumurtasÄ± 7 saniye boyunca bulunamadÄ±!")
    end
end)
